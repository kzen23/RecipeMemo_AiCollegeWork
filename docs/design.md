# RecipeMemo - 設計書

## 1. 概要

RecipeMemoは、料理のレシピを管理するシンプルなWebアプリケーションです。
レシピの登録・編集・削除・検索機能を提供し、日々の料理メモとして活用できます。

---

## 2. 機能仕様

### 2.1 機能一覧

| 機能 | 説明 | 優先度 |
|------|------|--------|
| レシピ一覧表示 | 登録されているレシピの一覧を表示 | Phase 1 |
| レシピ詳細表示 | レシピの詳細情報を表示 | Phase 1 |
| レシピ新規登録 | 新しいレシピを登録 | Phase 1 |
| レシピ編集 | 既存レシピの情報を編集 | Phase 1 |
| レシピ削除 | レシピを削除 | Phase 1 |
| レシピ検索 | 料理名でレシピを検索 | Phase 2 |
| お気に入り機能 | レシピをお気に入りに設定 | Phase 2 |
| カテゴリフィルタ | カテゴリでレシピを絞り込み | Phase 2 |
| 画像アップロード | レシピの画像を登録 | Phase 3 |

### 2.2 機能詳細

#### レシピ一覧表示
- 全レシピをカード形式またはリスト形式で表示
- 料理名、カテゴリ、調理時間、お気に入り状態を表示
- ページネーション対応（1ページ20件）

#### レシピ詳細表示
- 料理名
- 材料
- 作り方
- カテゴリ
- 調理時間
- 何人分
- お気に入り状態
- 画像（登録されている場合）
- 作成日時・更新日時

#### レシピ新規登録
- 必須項目: 料理名、材料、作り方
- 任意項目: カテゴリ、調理時間、何人分、画像URL
- バリデーション: 料理名は100文字以内

#### レシピ編集
- 既存レシピの全項目を編集可能
- バリデーションは新規登録と同様

#### レシピ削除
- 削除確認ダイアログを表示
- 削除後は一覧ページへリダイレクト

#### レシピ検索
- 料理名での部分一致検索
- 検索結果を一覧形式で表示

#### お気に入り機能
- レシピをお気に入りに設定/解除
- お気に入りのみを一覧表示する機能

#### カテゴリフィルタ
- カテゴリ: 和食、洋食、中華、その他
- カテゴリごとにレシピを絞り込み表示

---

## 3. 構造仕様

### 3.1 ER図

```
┌─────────────────────────┐
│       Recipe            │
├─────────────────────────┤
│ id: integer (PK)        │
│ name: string            │
│ ingredients: text       │
│ instructions: text      │
│ category: string        │
│ cooking_time: integer   │
│ servings: integer       │
│ favorite: boolean       │
│ image_url: string       │
│ created_at: datetime    │
│ updated_at: datetime    │
└─────────────────────────┘
```

### 3.2 テーブル定義

#### recipes テーブル

| カラム名 | データ型 | NULL | デフォルト | 説明 |
|----------|----------|------|------------|------|
| id | integer | NO | - | 主キー（自動採番） |
| name | string | NO | - | 料理名（最大100文字） |
| ingredients | text | NO | - | 材料 |
| instructions | text | NO | - | 作り方 |
| category | string | YES | - | カテゴリ（和食、洋食、中華、その他） |
| cooking_time | integer | YES | - | 調理時間（分） |
| servings | integer | YES | - | 何人分 |
| favorite | boolean | NO | false | お気に入りフラグ |
| image_url | string | YES | - | 画像URL |
| created_at | datetime | NO | - | 作成日時 |
| updated_at | datetime | NO | - | 更新日時 |

#### インデックス

| カラム名 | 種類 | 目的 |
|----------|------|------|
| name | index | 料理名での検索を高速化 |
| category | index | カテゴリでのフィルタリングを高速化 |
| favorite | index | お気に入りの絞り込みを高速化 |

### 3.3 バリデーション

| 項目 | バリデーション |
|------|----------------|
| name | 必須、最大100文字 |
| ingredients | 必須 |
| instructions | 必須 |
| cooking_time | 整数、0より大きい（任意） |
| servings | 整数、0より大きい（任意） |
| category | 任意 |
| favorite | boolean（デフォルト: false） |
| image_url | 任意 |

---

## 4. 画面遷移

```
[レシピ一覧] ─────┬─→ [レシピ詳細] ─→ [レシピ編集] ─→ [レシピ一覧]
      │          │         │
      │          │         └─→ [レシピ削除] ─→ [レシピ一覧]
      │          │
      └──────────┴─→ [レシピ新規登録] ─→ [レシピ一覧]
```

---

## 5. 技術スタック

### バックエンド
- Ruby on Rails 7.1
- Ruby 3.2以上

### データベース
- 開発環境: SQLite3
- 本番環境: PostgreSQL または MySQL

### フロントエンド
- View: ERB
- CSS: Bootstrap または Tailwind CSS
- JavaScript: Stimulus（必要に応じて）

### テスト
- RSpec
- FactoryBot
- Capybara（E2Eテスト）

---

## 6. 実装の優先順位

### Phase 1: 基本CRUD（最優先）
1. Railsプロジェクト作成
2. Recipeモデル作成（scaffold使用）
3. バリデーション追加
4. 基本的なビュー調整
5. テスト作成

### Phase 2: 検索・フィルタ機能
1. 料理名での検索機能
2. お気に入り機能
3. カテゴリフィルタ機能

### Phase 3: 拡張機能
1. 画像アップロード機能
2. UI/UXの改善
3. レスポンシブデザイン対応

---

## 7. セキュリティ考慮事項

- SQLインジェクション対策: ActiveRecordのパラメータバインディング使用
- XSS対策: ERBの自動エスケープ機能を活用
- CSRF対策: Railsのデフォルト機能を使用
- 画像URL検証: URLフォーマットのバリデーション

---

## 8. パフォーマンス考慮事項

- インデックスの適切な設定
- N+1クエリの防止（必要に応じてeager loading使用）
- ページネーションの実装（kaminai または pagy）
- 画像最適化（将来的にActive Storageで実装）

---

## 9. 今後の拡張案

- ユーザー認証機能（Devise）
- レシピの共有機能
- 材料の買い物リスト機能
- 栄養情報の追加
- タグ機能
- レシピのレビュー・評価機能
